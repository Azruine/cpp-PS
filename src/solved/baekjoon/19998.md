# 19998. [스도쿠](./19998.cpp)

댄싱 링크 테크닉을 쓰는 exact-cover 찾기 문제이다.

스도쿠를 DLX로 치환하는 것에 대해서는 [링크](https://jeonggyun.tistory.com/225)를 참조하자.

## 준비 과정

### 노드 구조체

```cpp
struct DancingNode {
    size_t left = 0, right = 0, up = 0, down = 0;
    size_t column = 0;
    size_t size = 0;

    std::optional<size_t> row, col, num;
};
```

노드 구조체이다. 원래는 스마트 포인터로 표현하려고 했지만, 문제 풀이용 코드에서 스마트 포인터는 오버헤드만 잔뜩 생기는 놈이라 그냥 인덱스로 표현했다.

아무튼, left ~ down 까지는 이 노드와 연결된 이웃 노드들이다.

행이 각 노드의 상태를, 열이 노드의 제약을 의미하고 있으므로 column 인덱스를 놔두어서 이 노드에 걸리는 제약이 무엇인지 알 수 있게 해준다.

size 변수는 column의 헤더 노드에서만 유효한 인덱스이다. 이 column에 종속된 일반 노드들, 즉 고를 수 있는 노드들의 개수를 저장한다.

row, col, num은 실제 보드에서 어떤 칸에 어떤 값을 기입하는 노드인지 저장한다.

### 댄싱 링크 클래스

여긴 쓰기 너무 귀찮아서 gpt한테 써달라고 했다.

size_t header_idx - 전체 연결 리스트의 시작점인 "헤더 노드" 인덱스

std::vector<DancingNode> nodes - 모든 노드(헤더 + 일반 행 선택 후보)를 저장하는 배열

std::vector<size_t> sol_stack - 재귀 탐색 중 선택된 행(후보) 노드 인덱스를 쌓아 두는 스택

std::vector<size_t> fixed_rows - 초기 입력된(고정된) 후보 행의 시작 노드 인덱스 목록

std::span<size_t> m_board - 외부에서 전달받은 스도쿠 판(1차원 배열) 참조

add_node() - 새 DancingNode 를 생성해 nodes 에 추가하고, 그 인덱스를 반환

search(size_t k) - 깊이 우선 탐색으로 Exact Cover 문제 해결

헤더가 자기 자신만 가리키면(모든 제약 해소) 성공 반환

select_column() 으로 최소 크기 열 선택

해당 열을 cover() 한 뒤, 각 행 후보를 순회하며 재귀 호출

실패 시 되돌리며(uncover()) 다음 후보 시도

select_column() - 헤더 오른쪽부터 순회하며 size 가 가장 작은 열 헤더 인덱스 반환

size 가 작을수록 제약 분기 수가 적어 탐색 효율 증가

cover(size_t col_idx) / uncover(size_t col_idx) - 컬럼 삭제·복구 연산

cover: 지정 열 헤더를 리스트에서 제외하고, 그 아래 모든 행 노드의 다른 열 연결도 갱신

uncover: cover 의 역순으로 원상 복구

init(std::span<size_t>& board) - 초기화

nodes, sol_stack, fixed_rows 비우기

헤더 노드 하나 추가 후, 전체 제약 개수(BOARD*BOARD*CONSTRAINT) 만큼 열 헤더 노드 연결

build() - 행 후보 노드 생성

각 칸마다 값이 있으면 고정 행으로, 없으면 1~BOARD 까지 모든 후보 행으로 add_row() 호출

고정된 행은 fixed_rows 에 저장 후 즉시 cover() 처리

add_row(size_t row, size_t col, size_t value) - 단일 행 후보(4개 제약) 노드 묶음 생성

셀 제약, 행 제약, 열 제약, 블록 제약에 대응하는 4개 노드 연결

각 노드는 좌우로 서로 연결해 하나의 링(행) 구성

bool solve(std::span<size_t> board) - 퍼즐 풀이 엔트리 포인트

init() → build()

search(fixed_rows.size()) 호출

성공 시 sol_stack 에 쌓인 비고정 노드 정보로 m_board 갱신

아... 복붙하고 보니 정말 못봐주겠다... 언젠간 내가 다시 쓰겠지...
